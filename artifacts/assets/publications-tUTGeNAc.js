import{r as s,j as e,T as Y,M as Te,m as E,F as B,B as ie,D as _e,E as Ce,n as L}from"./index-BBxgTFRz.js";import{A as w,L as Fe,b as Ae,D as ne,R as Re,c as _,e as Me}from"./en-aE7C3Vm9.js";import{I,S as W,M as r,b as Ye,c as Ee,d as Be,e as oe,f as m,g as Le,a as we,h as Ie}from"./TableRow-D1uAUnC5.js";import{G as l,T as We}from"./TableSortLabel-C5XydIVU.js";import"./ListItem-D2ZRKKsD.js";_.registerLocale(Me);const q={totalPublication:5e4,totalPublished:3e4,totalFailed:2e4},O=(c,h)=>h?Math.min(c/h*100,100).toFixed(2):"0.00",qe=[{id:"id",align:"left",label:"ID"},{id:"date",align:"left",label:"Date",orderBy:"date_created"},{id:"country",align:"left",label:"Country"},{id:"platform",align:"left",label:"Platform"},{id:"source",align:"left",label:"Source"},{id:"status",align:"left",label:"Status"}];function ce({order:c,orderBy:h,onRequestSort:d}){const C=a=>S=>{d(S,a)};return e.jsx(Ie,{children:e.jsx(oe,{children:qe.map(a=>e.jsx(m,{align:a.align,sortDirection:h===a.id?c:!1,children:a.orderBy?e.jsx(We,{active:h===a.id,direction:h===a.id?c:"asc",onClick:C(a.id),children:a.label}):a.label},a.id))})})}ce.propTypes={onRequestSort:L.func.isRequired,order:L.oneOf(["asc","desc"]).isRequired,orderBy:L.string.isRequired};function Ve(){const[c,h]=s.useState("desc"),[d,C]=s.useState("date"),[a,S]=s.useState(""),[y,k]=s.useState(""),[v,H]=s.useState(""),[f,N]=s.useState(null),[j,U]=s.useState(null),[de,G]=s.useState(!0),[V,z]=s.useState(null),[ue,F]=s.useState({}),[A,K]=s.useState(0),[R,he]=s.useState(10),[xe,pe]=s.useState(0),[g,me]=s.useState({totalPublication:0,totalPublished:0,totalFailed:0,percentages:{totalPublication:0,totalPublished:0,totalFailed:0}}),[ge,fe]=s.useState([]),je=(t,i)=>{const b=d===i&&c==="asc";h(b?"desc":"asc"),C(i),F(D=>({...D,sort_by:i,sort_order:b?"desc":"asc"}))},$=new Date().toISOString().split("T")[0],be=()=>{const t={platform:a,startDate:f?f.format("YYYY-MM-DD"):"2021-01-10",endDate:j?j.format("YYYY-MM-DD"):$,status:y,source:v};F(t)},Pe=()=>{S(""),k(""),H(""),N(null),U(null),F({})},Se=(t,i)=>K(i),ye=t=>{he(parseInt(t.target.value,10)),K(0)},ve=t=>t?t.toUpperCase().replace(/./g,i=>String.fromCodePoint(127397+i.charCodeAt())):"";return s.useEffect(()=>{(async()=>{var i,b,D,J,Q,X,Z,ee,te;G(!0);try{const M=f?f.format("YYYY-MM-DD"):"2021-01-10",De=j?j.format("YYYY-MM-DD"):$,T={start_date:M,end_date:De,page:A+1,page_size:R};a&&(T.platform_name=a),y&&(T.status=y),v&&(T.source=v);const x=await we.get("https://api.telemetry.smswithoutborders.com/v1/publications",{params:T}),ae=((i=x.data.publications)==null?void 0:i.data)||[];let se=[...Array.isArray(ae)?ae.map(n=>{var o;const p=((o=n==null?void 0:n.country_code)==null?void 0:o.toUpperCase())||"UNKNOWN",P=_.isValid(p,"en")?_.getName(p,"en"):"Unknown",u=_.isValid(p,"en")?ve(p):"";return{country:P||p,flag:u||"",country_code:p,id:n.id,date_created:n.date_created,platform_name:n.platform_name,source:n.source,status:n.status}}):[]];d&&se.sort((n,p)=>{const P=c==="asc",u=n[d],o=p[d];if(d==="date_created"){const le=new Date(u),re=new Date(o);return P?le.getTime()-re.getTime():re.getTime()-le.getTime()}return typeof u=="string"&&typeof o=="string"?P?u.localeCompare(o):o.localeCompare(u):typeof u=="number"&&typeof o=="number"?P?u-o:o-u:0}),me({totalPublication:((b=x.data.publications)==null?void 0:b.total_publications)||0,totalPublished:((D=x.data.publications)==null?void 0:D.total_published)||0,totalFailed:((J=x.data.publications)==null?void 0:J.total_failed)||0,percentages:{totalPublication:O((Q=x.data.publications)==null?void 0:Q.total_publications,q.totalPublication),totalPublished:O((X=x.data.publications)==null?void 0:X.total_published,q.totalPublished),totalFailed:O((Z=x.data.publications)==null?void 0:Z.total_failed,q.totalFailed)}}),fe(se),pe(((te=(ee=x.data.publications)==null?void 0:ee.pagination)==null?void 0:te.total_records)||0),z(null)}catch(M){console.error("Error fetching metrics:",M),z("Failed to fetch metrics. Please try again later.")}finally{G(!1)}})()},[ue,A,R,c,d]),e.jsxs(l,{container:!0,rowSpacing:4.5,columnSpacing:2.75,children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(Y,{variant:"h5",children:"Open Telemetry"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:2,children:e.jsx(w,{title:"Publications",count:g.totalPublication.toLocaleString(),percentage:g.percentages.totalPublication,extra:"All Publications"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:2,children:e.jsx(w,{title:"Published",count:g.totalPublished.toLocaleString(),percentage:g.percentages.totalPublished,extra:"Successful Publications"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:2,children:e.jsx(w,{title:"Failed",count:g.totalFailed.toLocaleString(),percentage:g.percentages.totalFailed,extra:"Failed Publications"})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(Fe,{dateAdapter:Ae,children:e.jsx(Te,{sx:{mt:1},content:!1,children:e.jsxs(E,{sx:{p:3},children:[e.jsx(Y,{variant:"h6",color:"text.secondary",sx:{mb:2},children:"Filters"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(B,{fullWidth:!0,children:[e.jsx(I,{children:"Platform"}),e.jsxs(W,{sx:{height:"53px"},value:a,onChange:t=>S(t.target.value),label:"Platform",children:[e.jsx(r,{value:"",children:"All"}),e.jsx(r,{value:"gmail",children:"Gmail"}),e.jsx(r,{value:"twitter",children:"Twitter"}),e.jsx(r,{value:"telegram",children:"Telegram"}),e.jsx(r,{value:"email_bridge",children:"Email Bridge"})]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(B,{fullWidth:!0,children:[e.jsx(I,{children:"Status"}),e.jsxs(W,{sx:{height:"53px"},value:y,onChange:t=>k(t.target.value),label:"Status",children:[e.jsx(r,{value:"",children:"All"}),e.jsx(r,{value:"published",children:"Published"}),e.jsx(r,{value:"failed",children:"Failed"})]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(B,{fullWidth:!0,children:[e.jsx(I,{children:"Source"}),e.jsxs(W,{sx:{height:"53px"},value:v,onChange:t=>H(t.target.value),label:"Source",children:[e.jsx(r,{value:"",children:"All"}),e.jsx(r,{value:"platforms",children:"Platform"}),e.jsx(r,{value:"bridges",children:"Bridge"})]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{label:"Start Date",value:f,onChange:t=>N(t),fullWidth:!0})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{label:"End Date",value:j,onChange:t=>U(t),fullWidth:!0})}),e.jsx(l,{item:!0,xs:6,sm:6,md:2,children:e.jsx(ie,{sx:{height:"53px",px:4},fullWidth:!0,variant:"contained",onClick:be,children:"Apply"})}),e.jsx(l,{item:!0,xs:6,sm:6,md:2,children:e.jsx(ie,{sx:{height:"53px",px:4},fullWidth:!0,variant:"outlined",startIcon:e.jsx(Re,{}),onClick:Pe,children:"Reset"})})]})]})})})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(_e,{children:[e.jsx(Ye,{sx:{minHeight:400,maxHeight:400},children:de?e.jsx(E,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Ce,{})}):V?e.jsx(E,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Y,{color:"error",children:V})}):e.jsxs(Ee,{children:[e.jsx(ce,{order:c,orderBy:d,onRequestSort:je}),e.jsx(Be,{children:ge.map(t=>e.jsxs(oe,{children:[e.jsx(m,{children:t.id}),e.jsx(m,{children:new Date(t.date_created).toLocaleString()}),e.jsxs(m,{children:[e.jsx("span",{style:{marginRight:8},children:t.flag}),t.country?t.country:"No Country"]}),e.jsx(m,{children:t.platform_name}),e.jsx(m,{children:t.source}),e.jsx(m,{children:t.status})]},t.id))})]})}),e.jsx(Le,{component:"div",count:xe,page:A,onPageChange:Se,rowsPerPage:R,onRowsPerPageChange:ye})]})})]})}export{Ve as default};
