import{r as c,k as Te,j as Ge,l as Me,m as Ne,aF as Be,v as a,z as Ee,x as Fe,B as Ve,aG as Z,aH as ne,O as H,Q as te,Z as We,$ as ze,P as ge,aI as Ie,U as se}from"./index-EJiCpkVe.js";import{R as Le,A as Ue,c as W,u as Ye,e as qe}from"./en-O0g5YPDM.js";import{n as z,B as ae,q as He,S as re,f as Ke,h as Ze,i as Je,j as ye,k as A,l as Qe,e as K,o as Xe}from"./dayjs.min-BC2U5BeA.js";import{T as et,t as tt}from"./timezone-YrwZ_CZJ.js";import"./isHostComponent-DVu5iVWx.js";const me=c.createContext();function st(e){return Te("MuiGrid",e)}const at=[0,1,2,3,4,5,6,7,8,9,10],rt=["column-reverse","column","row-reverse","row"],nt=["nowrap","wrap-reverse","wrap"],F=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],I=Ge("MuiGrid",["root","container","item","zeroMinWidth",...at.map(e=>`spacing-xs-${e}`),...rt.map(e=>`direction-xs-${e}`),...nt.map(e=>`wrap-xs-${e}`),...F.map(e=>`grid-xs-${e}`),...F.map(e=>`grid-sm-${e}`),...F.map(e=>`grid-md-${e}`),...F.map(e=>`grid-lg-${e}`),...F.map(e=>`grid-xl-${e}`)]);function ot({theme:e,ownerState:r}){let n;return e.breakpoints.keys.reduce((o,s)=>{let i={};if(r[s]&&(n=r[s]),!n)return o;if(n===!0)i={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(n==="auto")i={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const f=Z({values:r.columns,breakpoints:e.breakpoints.values}),m=typeof f=="object"?f[s]:f;if(m==null)return o;const h=`${Math.round(n/m*1e8)/1e6}%`;let p={};if(r.container&&r.item&&r.columnSpacing!==0){const x=e.spacing(r.columnSpacing);if(x!=="0px"){const S=`calc(${h} + ${x})`;p={flexBasis:S,maxWidth:S}}}i={flexBasis:h,flexGrow:0,maxWidth:h,...p}}return e.breakpoints.values[s]===0?Object.assign(o,i):o[e.breakpoints.up(s)]=i,o},{})}function it({theme:e,ownerState:r}){const n=Z({values:r.direction,breakpoints:e.breakpoints.values});return ne({theme:e},n,o=>{const s={flexDirection:o};return o.startsWith("column")&&(s[`& > .${I.item}`]={maxWidth:"none"}),s})}function he({breakpoints:e,values:r}){let n="";Object.keys(r).forEach(s=>{n===""&&r[s]!==0&&(n=s)});const o=Object.keys(e).sort((s,i)=>e[s]-e[i]);return o.slice(0,o.indexOf(n))}function lt({theme:e,ownerState:r}){const{container:n,rowSpacing:o}=r;let s={};if(n&&o!==0){const i=Z({values:o,breakpoints:e.breakpoints.values});let f;typeof i=="object"&&(f=he({breakpoints:e.breakpoints.values,values:i})),s=ne({theme:e},i,(m,h)=>{const p=e.spacing(m);return p!=="0px"?{marginTop:`calc(-1 * ${p})`,[`& > .${I.item}`]:{paddingTop:p}}:f?.includes(h)?{}:{marginTop:0,[`& > .${I.item}`]:{paddingTop:0}}})}return s}function ct({theme:e,ownerState:r}){const{container:n,columnSpacing:o}=r;let s={};if(n&&o!==0){const i=Z({values:o,breakpoints:e.breakpoints.values});let f;typeof i=="object"&&(f=he({breakpoints:e.breakpoints.values,values:i})),s=ne({theme:e},i,(m,h)=>{const p=e.spacing(m);if(p!=="0px"){const x=`calc(-1 * ${p})`;return{width:`calc(100% + ${p})`,marginLeft:x,[`& > .${I.item}`]:{paddingLeft:p}}}return f?.includes(h)?{}:{width:"100%",marginLeft:0,[`& > .${I.item}`]:{paddingLeft:0}}})}return s}function dt(e,r,n={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[n[`spacing-xs-${String(e)}`]];const o=[];return r.forEach(s=>{const i=e[s];Number(i)>0&&o.push(n[`spacing-${s}-${String(i)}`])}),o}const ut=Ee("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:n}=e,{container:o,direction:s,item:i,spacing:f,wrap:m,zeroMinWidth:h,breakpoints:p}=n;let x=[];o&&(x=dt(f,p,r));const S=[];return p.forEach(_=>{const R=n[_];R&&S.push(r[`grid-${_}-${String(R)}`])}),[r.root,o&&r.container,i&&r.item,h&&r.zeroMinWidth,...x,s!=="row"&&r[`direction-xs-${String(s)}`],m!=="wrap"&&r[`wrap-xs-${String(m)}`],...S]}})(({ownerState:e})=>({boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},...e.item&&{margin:0},...e.zeroMinWidth&&{minWidth:0},...e.wrap!=="wrap"&&{flexWrap:e.wrap}}),it,lt,ct,ot);function pt(e,r){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[`spacing-xs-${String(e)}`];const n=[];return r.forEach(o=>{const s=e[o];if(Number(s)>0){const i=`spacing-${o}-${String(s)}`;n.push(i)}}),n}const ft=e=>{const{classes:r,container:n,direction:o,item:s,spacing:i,wrap:f,zeroMinWidth:m,breakpoints:h}=e;let p=[];n&&(p=pt(i,h));const x=[];h.forEach(_=>{const R=e[_];R&&x.push(`grid-${_}-${String(R)}`)});const S={root:["root",n&&"container",s&&"item",m&&"zeroMinWidth",...p,o!=="row"&&`direction-xs-${String(o)}`,f!=="wrap"&&`wrap-xs-${String(f)}`,...x]};return Ve(S,st,r)},V=c.forwardRef(function(r,n){const o=Me({props:r,name:"MuiGrid"}),{breakpoints:s}=Ne(),i=Be(o),{className:f,columns:m,columnSpacing:h,component:p="div",container:x=!1,direction:S="row",item:_=!1,rowSpacing:R,spacing:D=0,wrap:J="wrap",zeroMinWidth:Q=!1,...O}=i,L=R||D,U=h||D,l=c.useContext(me),T=x?m||12:l,G={},P={...O};s.keys.forEach(N=>{O[N]!=null&&(G[N]=O[N],delete P[N])});const M={...i,columns:T,container:x,direction:S,item:_,rowSpacing:L,columnSpacing:U,wrap:J,zeroMinWidth:Q,spacing:D,...G,breakpoints:s.keys},X=ft(M);return a.jsx(me.Provider,{value:T,children:a.jsx(ut,{ownerState:M,className:Fe(X.root,f),as:p,ref:n,...P})})});z.extend(Ye);z.extend(tt);W.registerLocale(qe);const gt={totalGatewayClients:2e4},mt=(e,r)=>r?Math.min(e/r*100,100).toFixed(2):"0.00",yt=[{id:"msisdn",align:"left",label:"Msisdn"},{id:"country",align:"left",label:"Country"},{id:"operator",align:"left",label:"Operator"},{id:"operator_code",align:"left",label:"Operator code"},{id:"reliability",align:"left",label:"Reliability"},{id:"last_published_date",align:"left",label:"Date",orderBy:"last_published_date"}];function xe({order:e,orderBy:r,onRequestSort:n}){const o=s=>i=>{n(i,s)};return a.jsx(Xe,{sx:{backgroundColor:"background.default",position:"sticky",top:0,zIndex:1},children:a.jsx(ye,{children:yt.map(s=>a.jsx(A,{align:s.align,sortDirection:r===s.id?e:!1,children:s.orderBy?a.jsx(et,{active:r===s.id,direction:r===s.id?e:"asc",onClick:o(s.id),children:s.label}):s.label},s.id))})})}xe.propTypes={onRequestSort:se.func.isRequired,order:se.oneOf(["asc","desc"]).isRequired,orderBy:se.string.isRequired};function Ct(){const[e,r]=c.useState("desc"),[n,o]=c.useState("last_published_date"),[s,i]=c.useState(""),[f,m]=c.useState(""),[h,p]=c.useState(""),[x,S]=c.useState(""),[_,R]=c.useState(""),[D,J]=c.useState(null),[Q,O]=c.useState(!0),[L,U]=c.useState(null),[l,T]=c.useState({}),[G,P]=c.useState(0),[M,X]=c.useState(10),[N,oe]=c.useState(0),[Y,be]=c.useState("day"),[we,ie]=c.useState({totalGatewayClients:0,percentages:{totalGatewayClients:0}}),[q,le]=c.useState([]),[Se,Ce]=c.useState([]),[ve,je]=c.useState([]),[_e,ce]=c.useState({}),[de,ee]=c.useState(!1),Re=(t,d)=>{const g=n===d&&e==="asc";r(g?"desc":"asc"),o(d),T(C=>({...C,sort_by:d,sort_order:g?"desc":"asc"}))},$e=()=>{const t={msisdn:h,country:s,operator:f,operatorCode:x,reliability:_,dateFilter:D?z(D).format("YYYY-MM-DD"):"2020-01-10"};T(t),P(0)},ke=()=>{i(""),m(""),J(null),p(""),S(""),R(""),T({}),P(0)},Pe=async()=>{try{const t=l.dateFilter||"2020-01-10",d={date_filter:t,page:1,page_size:100};l.country&&(d.country=l.country),l.operator&&(d.operator=l.operator),l.msisdn&&(d.msisdn=l.msisdn),l.operatorCode&&(d.operator_code=l.operatorCode);const g=await K.get("https://gatewayserver.staging.smswithoutborders.com/v3/clients",{params:d}),C=g?.data?.pagination?.total_pages||1;let y=g?.data||[];if(Array.isArray(y)?y=y:y=[],C>1){const b=[];for(let w=2;w<=C;w++)b.push(K.get("https://gatewayserver.staging.smswithoutborders.com/v3/clients",{params:{...d,page:w}}));(await Promise.all(b)).forEach(w=>{const fe=w?.data||[];Array.isArray(fe)&&(y=[...y,...fe])})}const k={metadata:{exportDate:new Date().toISOString(),totalRecords:y.length,filters:{country:l.country||"All",operator:l.operator||"All",msisdn:l.msisdn||"All",operatorCode:l.operatorCode||"All",dateFilter:t}},clients:y},$=JSON.stringify(k,null,2),B=new Blob([$],{type:"application/json"}),E=window.URL.createObjectURL(B),u=document.createElement("a");u.href=E;const v=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);u.download=`reliability-data-${v}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(E)}catch(t){console.error("Error downloading reliability data:",t),alert("Failed to download data. Please try again.")}},Ae=(t,d)=>P(d),De=t=>{X(parseInt(t.target.value,10)),P(0)},ue=t=>t?t.toUpperCase().replace(/./g,d=>String.fromCodePoint(127397+d.charCodeAt())):"",Oe=t=>z(t).local().format("MMM DD, YYYY hh:mm:ss A"),pe=c.useCallback(()=>{const t=z();switch(Y){case"day":return{start:t.startOf("day").unix(),end:t.endOf("day").unix()};case"week":return{start:t.startOf("week").unix(),end:t.endOf("week").unix()};case"month":return{start:t.startOf("month").unix(),end:t.endOf("month").unix()};case"all":default:return{start:0,end:t.unix()}}},[Y]);return c.useEffect(()=>{(async()=>{O(!0),U(null);try{const g={date_filter:l.dateFilter||"2020-01-10",page:G+1,page_size:M};l.country&&(g.country=l.country),l.operator&&(g.operator=l.operator),l.msisdn&&(g.msisdn=l.msisdn),l.operatorCode&&(g.operator_code=l.operatorCode),l.sort_by&&(g.sort_by=l.sort_by),l.sort_order&&(g.sort_order=l.sort_order);const C=await K.get("https://gatewayserver.staging.smswithoutborders.com/v3/clients",{params:g}),y=C.data||[],k=new Set,$=new Set;y.forEach(u=>{u?.country&&k.add(u.country),u?.operator&&$.add(u.operator)}),Ce(["",...Array.from(k).sort()]),je(["",...Array.from($).sort()]);let E=[...Array.isArray(y)?y.map(u=>{const v=u?.country||"Unknown",b=W.getAlpha2Code(v,"en")?.toUpperCase()||"UNKNOWN",j=W.isValid(b,"en")?ue(b):"";return{country:v,flag:j||"",country_code:b,msisdn:u.msisdn,operator:u.operator,operator_code:u.operator_code,last_published_date:new Date(u.last_published_date*1e3)}}):[]];g.sort_by||E.sort((u,v)=>{const b=e==="asc",j=u[n],w=v[n];return n==="last_published_date"?b?u.last_published_date.getTime()-v.last_published_date.getTime():v.last_published_date.getTime()-u.last_published_date.getTime():typeof j=="string"&&typeof w=="string"?b?j.localeCompare(w):w.localeCompare(j):typeof j=="number"&&typeof w=="number"?b?j-w:w-j:0}),le(E),oe(C.data?.pagination?.total_records||y.length),ie({totalGatewayClients:C.data?.total_clients||y.length,percentages:{totalGatewayClients:mt(C.data?.total_clients||y.length,gt.totalGatewayClients)}})}catch(d){console.error("Error fetching clients:",d),U("Failed to fetch clients. Please try again later."),le([]),oe(0),ie({totalGatewayClients:0,percentages:{totalGatewayClients:0}})}finally{O(!1)}})()},[l,G,M,e,n]),c.useEffect(()=>{(async()=>{if(!q.length||de){ce({}),ee(!1);return}ee(!0);const{start:d,end:g}=pe(),C=new Date(d*1e3).toISOString(),y=new Date(g*1e3).toISOString(),k={};await Promise.allSettled(q.map(async $=>{try{const B={start_time:C,end_time:y},u=(await K.get(`https://gatewayserver.staging.smswithoutborders.com/v3/clients/${$.msisdn}/tests`,{params:B})).data||{},v=u.total_records||0,b=u.total_success||0,j=v>0?(b/v*100).toFixed(2):"0.00";k[$.msisdn]=j}catch(B){console.error(`Error fetching reliability for ${$.msisdn}:`,B),k[$.msisdn]="N/A"}})),ce(k),ee(!1)})()},[q,Y,pe]),a.jsxs(V,{container:!0,rowSpacing:4.5,columnSpacing:2.75,children:[a.jsx(V,{item:!0,xs:12,children:a.jsxs(H,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(te,{variant:"h5",children:"Reliability"}),a.jsx(ae,{type:"default",icon:a.jsx(Le,{}),onClick:Pe,children:"Download Data"})]})}),a.jsx(V,{item:!0,xs:12,sm:6,md:2,children:a.jsx(Ue,{title:"Gateway Clients",count:we.totalGatewayClients.toLocaleString(),extra:"Total number of listed Gateway Clients"})}),a.jsx(V,{item:!0,xs:12,children:a.jsxs(H,{children:[a.jsx(te,{variant:"h6",color:"text.secondary",sx:{mb:2},children:"Filters"}),a.jsxs(He,{wrap:!0,size:"middle",children:[a.jsx(re,{placeholder:"Country",value:s||void 0,onChange:t=>i(t||""),style:{width:200},allowClear:!0,options:Se.filter(t=>t!=="").map(t=>{const d=W.getAlpha2Code(t,"en")?.toUpperCase()||"",g=W.isValid(d,"en")?ue(d):"";return{value:t,label:a.jsxs("span",{children:[g&&a.jsx("span",{style:{marginRight:8},children:g}),t]})}})}),a.jsx(re,{placeholder:"Operator",value:f||void 0,onChange:t=>m(t||""),style:{width:150},allowClear:!0,options:ve.filter(t=>t!=="").map(t=>({value:t,label:t}))}),a.jsx(re,{placeholder:"Reliability Period",value:Y,onChange:t=>be(t),style:{width:150},options:[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"all",label:"All"}]}),a.jsx(ae,{type:"primary",onClick:$e,children:"Apply"}),a.jsx(ae,{icon:a.jsx(We,{}),onClick:ke,children:"Reset"})]})]})}),a.jsx(V,{item:!0,xs:12,children:a.jsxs(ze,{children:[a.jsx(Ke,{sx:{minHeight:400,maxHeight:400},children:Q?a.jsx(H,{display:"flex",justifyContent:"center",p:4,children:a.jsx(ge,{size:50,fullScreen:!1})}):L?a.jsx(H,{display:"flex",justifyContent:"center",p:4,children:a.jsx(te,{color:"error",children:L})}):a.jsxs(Ze,{children:[a.jsx(xe,{order:e,orderBy:n,onRequestSort:Re}),a.jsx(Je,{children:q.map(t=>{const d=_e[t.msisdn];return a.jsxs(ye,{hover:!0,style:{cursor:"pointer"},children:[a.jsx(A,{children:a.jsx(Ie,{to:`/tests/${t.msisdn}`,style:{textDecoration:"none",color:"inherit"},children:t.msisdn})}),a.jsxs(A,{children:[a.jsx("span",{style:{marginRight:8},children:t.flag}),t.country?t.country:"No Country"]}),a.jsx(A,{children:t.operator}),a.jsx(A,{children:t.operator_code}),a.jsx(A,{children:de?a.jsx(ge,{size:16,fullScreen:!1}):d!==void 0?`${d}%`:"N/A"}),a.jsx(A,{children:Oe(t.last_published_date)})]},t.msisdn)})})]})}),a.jsx(Qe,{component:"div",count:N,page:G,onPageChange:Ae,rowsPerPage:M,onRowsPerPageChange:De})]})})]})}export{Ct as default};
