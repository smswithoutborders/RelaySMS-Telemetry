import{r as a,j as e,T as R,M as fe,m as D,F as N,B as U,D as me,E as je,Q as be,n as w}from"./index-BBxgTFRz.js";import{A as Ce,L as Se,b as _e,D as ve,R as Te,c as F,e as Pe}from"./en-aE7C3Vm9.js";import{I as z,S as V,M as C,b as Ae,c as Re,d as De,e as $,f as h,g as we,a as Fe,h as Me}from"./TableRow-D1uAUnC5.js";import{G as n,T as Oe}from"./TableSortLabel-C5XydIVU.js";import"./ListItem-D2ZRKKsD.js";F.registerLocale(Pe);const Ge={totalGatewayClients:2e4},Le=(o,d)=>d?Math.min(o/d*100,100).toFixed(2):"0.00",Ee=[{id:"msisdn",align:"left",label:"Msisdn"},{id:"country",align:"left",label:"Country"},{id:"operator",align:"left",label:"Operator"},{id:"operator_code",align:"left",label:"Operator code"},{id:"reliability",align:"left",label:"Reliability"},{id:"last_published_date",align:"left",label:"Date",orderBy:"last_published_date"}];function K({order:o,orderBy:d,onRequestSort:i}){const S=r=>f=>{i(f,r)};return e.jsx(Me,{children:e.jsx($,{children:Ee.map(r=>e.jsx(h,{align:r.align,sortDirection:d===r.id?o:!1,children:r.orderBy?e.jsx(Oe,{active:d===r.id,direction:d===r.id?o:"asc",onClick:S(r.id),children:r.label}):r.label},r.id))})})}K.propTypes={onRequestSort:w.func.isRequired,order:w.oneOf(["asc","desc"]).isRequired,orderBy:w.string.isRequired};function ze(){const[o,d]=a.useState("desc"),[i,S]=a.useState("last_published_date"),[r,f]=a.useState(""),[m,M]=a.useState(""),[Q,Be]=a.useState(""),[J,Ie]=a.useState(""),[X,Ye]=a.useState(""),[g,O]=a.useState(null),[Z,G]=a.useState(!0),[L,E]=a.useState(null),[ee,_]=a.useState({}),[v,B]=a.useState(0),[T,te]=a.useState(10),[se,ae]=a.useState(0),[I,re]=a.useState({totalGatewayClients:0,percentages:{totalGatewayClients:0}}),[ne,le]=a.useState([]),[oe,ie]=a.useState([]),[ce,de]=a.useState([]),ue=(t,l)=>{const y=i===l&&o==="asc";d(y?"desc":"asc"),S(l),_(j=>({...j,sort_by:l,sort_order:y?"desc":"asc"}))};new Date().toISOString().split("T")[0];const pe=()=>{const t={msisdn:Q,country:r,operator:m,operatorCode:J,reliability:X,dateFilter:g?g.format("YYYY-MM-DD"):"2021-01-10"};_(t)},he=()=>{f(""),M(""),O(null),_({})},xe=(t,l)=>B(l),ge=t=>{te(parseInt(t.target.value,10)),B(0)},ye=t=>t.toUpperCase().replace(/./g,l=>String.fromCodePoint(127397+l.charCodeAt()));return a.useEffect(()=>{(async()=>{var l,y,j,Y;G(!0);try{const P={date_filter:g?g.format("YYYY-MM-DD"):"2021-01-10",page:v+1,page_size:T};r&&(P.country=r),m&&(P.operator=m);const b=await Fe.get("https://gatewayserver.smswithoutborders.com/v3/clients",{params:P}),A=b.data||[],q=new Set,W=new Set;A.forEach(s=>{s!=null&&s.country&&q.add(s.country),s!=null&&s.operator&&W.add(s.operator)}),ie(["",...Array.from(q).sort()]),de(["",...Array.from(W).sort()]);let H=[...Array.isArray(A)?A.map(s=>{var c;const x=(s==null?void 0:s.country)||"Unknown",p=((c=F.getAlpha2Code(x,"en"))==null?void 0:c.toUpperCase())||"UNKNOWN",u=F.isValid(p,"en")?ye(p):"";return{country:x,flag:u||"",country_code:p,msisdn:s.msisdn,operator:s.operator,operator_code:s.operator_code,reliability:s.reliability,last_published_date:new Date(s.last_published_date*1e3)}}):[]];i&&H.sort((s,x)=>{const p=o==="asc",u=s[i],c=x[i];return i==="last_published_date"?p?s.last_published_date.getTime()-x.last_published_date.getTime():x.last_published_date.getTime()-s.last_published_date.getTime():typeof u=="string"&&typeof c=="string"?p?u.localeCompare(c):c.localeCompare(u):typeof u=="number"&&typeof c=="number"?p?u-c:c-u:0}),re({totalGatewayClients:((l=b.data)==null?void 0:l.length)||0,percentages:{totalGatewayClients:Le((y=b.data)==null?void 0:y.length,Ge.totalGatewayClients)}}),le(H),ae(((Y=(j=b.data)==null?void 0:j.pagination)==null?void 0:Y.total_records)||0),E(null)}catch(k){console.error("Error fetching metrics:",k),E("Failed to fetch metrics. Please try again later.")}finally{G(!1)}})()},[ee,v,T,o,i]),e.jsxs(n,{container:!0,rowSpacing:4.5,columnSpacing:2.75,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(R,{variant:"h5",children:"Open Telemetry"})}),e.jsx(n,{item:!0,xs:12,sm:6,md:2,children:e.jsx(Ce,{title:"Gateway CLients",count:I.totalGatewayClients.toLocaleString(),percentage:I.percentages.totalGatewayClients,extra:"Total number of listed Gateway Clients"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(Se,{dateAdapter:_e,children:e.jsx(fe,{sx:{mt:1},content:!1,children:e.jsxs(D,{sx:{p:3},children:[e.jsx(R,{variant:"h6",color:"text.secondary",sx:{mb:2},children:"Filters"}),e.jsxs(n,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(N,{fullWidth:!0,children:[e.jsx(z,{children:"Country"}),e.jsxs(V,{sx:{height:53},value:r,onChange:t=>f(t.target.value),label:"Country",children:[e.jsx(C,{value:"",children:"All"}),oe.map(t=>e.jsx(C,{value:t,children:t},t))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(N,{fullWidth:!0,children:[e.jsx(z,{children:"Operator"}),e.jsxs(V,{sx:{height:53},value:m,onChange:t=>M(t.target.value),label:"Operator",children:[e.jsx(C,{value:"",children:"All"}),ce.map(t=>e.jsx(C,{value:t,children:t},t))]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,md:2,children:e.jsx(ve,{label:"Date",value:g,onChange:t=>O(t),slotProps:{textField:{fullWidth:!0,sx:{height:53}}}})}),e.jsx(n,{item:!0,xs:6,sm:3,md:2,children:e.jsx(U,{sx:{height:53},fullWidth:!0,variant:"contained",onClick:pe,children:"Apply"})}),e.jsx(n,{item:!0,xs:6,sm:3,md:3,children:e.jsx(U,{sx:{height:53},fullWidth:!0,variant:"outlined",startIcon:e.jsx(Te,{}),onClick:he,children:"Reset"})})]})]})})})}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(me,{children:[e.jsx(Ae,{sx:{minHeight:400,maxHeight:400},children:Z?e.jsx(D,{display:"flex",justifyContent:"center",p:4,children:e.jsx(je,{})}):L?e.jsx(D,{display:"flex",justifyContent:"center",p:4,children:e.jsx(R,{color:"error",children:L})}):e.jsxs(Re,{children:[e.jsx(K,{order:o,orderBy:i,onRequestSort:ue}),e.jsx(De,{children:ne.map(t=>e.jsxs($,{hover:!0,style:{cursor:"pointer"},children:[e.jsx(h,{children:e.jsx(be,{to:`/tests/${t.msisdn}`,style:{textDecoration:"none",color:"inherit"},children:t.msisdn})}),e.jsxs(h,{children:[e.jsx("span",{style:{marginRight:8},children:t.flag}),t.country?t.country:"No Country"]}),e.jsx(h,{children:t.operator}),e.jsx(h,{children:t.operator_code}),e.jsxs(h,{children:[t.reliability,"%"]}),e.jsx(h,{children:t.last_published_date.toLocaleString()})]},t.msisdn))})]})}),e.jsx(we,{component:"div",count:se,page:v,onPageChange:xe,rowsPerPage:T,onRowsPerPageChange:ge})]})})]})}export{ze as default};
