import{aO as $,r as a,v as e,P as z,Q as f,aI as Y,V as b,O as p,$ as N}from"./index-EJiCpkVe.js";import{n as y,B as q,q as G,S as H,f as Q,h as U,o as V,j as w,k as s,i as W,l as J,e as K}from"./dayjs.min-BC2U5BeA.js";import{E as X,R as Z,D as ee}from"./ErrorDisplay-DfQq9uVU.js";import"./isHostComponent-DVu5iVWx.js";function ne(){const{msisdn:d}=$(),[D,T]=a.useState([]),[h,_]=a.useState([]),[C,u]=a.useState(!0),[F,x]=a.useState(null),[l,R]=a.useState(""),[n,E]=a.useState(""),[g,m]=a.useState(0),[i,A]=a.useState(5);a.useEffect(()=>{(async()=>{u(!0),x(null);let r=1;const j=100;let c=[],S=!0;try{for(;S;){const v=(await K.get(`https://gatewayserver.staging.smswithoutborders.com/v3/clients/${d}/tests?page=${r}&per_page=${j}`)).data.data;v.length>0?(c=[...c,...v],r++):S=!1}T(c)}catch(P){console.error("Error fetching tests:",P),x("Unable to fetch test data")}finally{u(!1)}})()},[d]),a.useEffect(()=>{let t=[...D];if(l&&(t=t.filter(r=>r.status===l)),n){const r=y(n).startOf("day");t=t.filter(j=>y(j.start_time*1e3).startOf("day").isSame(r))}_(t),m(0)},[D,l,n]);const B=(t,r)=>{m(r)},I=t=>{A(parseInt(t.target.value,10)),m(0)},k=t=>{R(t||"")},L=t=>{E(t)},M=()=>{x(null),u(!0),window.location.reload()},O=h.slice(g*i,g*i+i);if(C)return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:e.jsx(z,{size:50,fullScreen:!1})});if(F)return e.jsx(X,{onRetry:M,message:"We couldn't load the test data. Please try again."});const o=t=>t?new Date(t*1e3).toLocaleString():"N/A";return e.jsxs("div",{children:[e.jsxs(f,{variant:"h5",gutterBottom:!0,children:["Tests for MSISDN: ",d]}),e.jsx(Y,{to:"/reliability",style:{textDecoration:"none"},children:e.jsx(q,{type:"link",icon:e.jsx(Z,{}),style:{marginBottom:16,paddingLeft:0},children:"Back"})}),e.jsx(b,{size:{xs:12},children:e.jsxs(p,{children:[e.jsx(f,{variant:"h6",color:"text.secondary",sx:{mb:2},children:"Filters"}),e.jsxs(G,{wrap:!0,size:"middle",children:[e.jsx(H,{placeholder:"Status",value:l||void 0,onChange:k,style:{width:150},allowClear:!0,options:[{value:"pending",label:"Pending"},{value:"success",label:"Success"},{value:"timedout",label:"Timedout"}]}),e.jsx(ee,{placeholder:"Filter by Date",value:n?y(n):null,onChange:L,format:"YYYY-MM-DD"})]})]})}),e.jsx(b,{size:{xs:12},sx:{mt:2},children:h.length>0?e.jsx(N,{children:e.jsxs(Q,{children:[e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(w,{children:[e.jsx(s,{children:"ID"}),e.jsx(s,{children:"start_time"}),e.jsx(s,{children:"sms_received_time"}),e.jsx(s,{children:"sms_routed_time"}),e.jsx(s,{children:"sms_sent_time"}),e.jsx(s,{children:"Status"})]})}),e.jsx(W,{children:O.map(t=>e.jsxs(w,{children:[e.jsx(s,{children:t.id}),e.jsx(s,{children:o(t.start_time)}),e.jsx(s,{children:o(t.sms_received_time)}),e.jsx(s,{children:o(t.sms_routed_time)}),e.jsx(s,{children:o(t.sms_sent_time)}),e.jsx(s,{children:e.jsxs(p,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(p,{sx:{width:10,height:10,borderRadius:"50%",backgroundColor:t.status==="success"?"#52C41A":t.status==="timedout"?"#FF4D4F":t.status==="pending"?"#FAAD14":"grey",mr:1}}),t.status]})})]},t.id))})]}),e.jsx(J,{rowsPerPageOptions:[5,10,25,50,75,100],component:"div",count:h.length,rowsPerPage:i,page:g,onPageChange:B,onRowsPerPageChange:I})]})}):e.jsx(f,{children:"No tests found matching your criteria."})})]})}export{ne as default};
